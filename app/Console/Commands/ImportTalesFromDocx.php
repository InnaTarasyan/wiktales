<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\Storage;
use Illuminate\Support\Str;
use App\Models\Tale;
use App\Models\TaleSection;
use App\Services\DocxParser;

class ImportTalesFromDocx extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'tales:import';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Импорт сказок из .docx файлов в storage/tales';

    /**
     * Execute the console command.
     */
    public function handle()
    {
        $legacyDir = base_path('storage/tales');
        $appDir = storage_path('app/tales');
        $candidates = [];
        if (is_dir($legacyDir)) {
            $candidates = array_merge($candidates, glob($legacyDir . '/*.docx') ?: []);
        }
        if (is_dir($appDir)) {
            $candidates = array_merge($candidates, glob($appDir . '/*.docx') ?: []);
        }
        // de-duplicate
        $files = collect($candidates)->unique()->values();

        if ($files->isEmpty()) {
            $this->info('Файлы .docx не найдены в storage/tales или storage/app/tales');
            return self::SUCCESS;
        }

        $parser = app(DocxParser::class);

        foreach ($files as $fullPath) {
            $this->line("Импорт: {$fullPath}");

            try {
                $data = $parser->parse($fullPath);
            } catch (\Throwable $e) {
                $this->error("Ошибка парсинга {$fullPath}: " . $e->getMessage());
                continue;
            }

            $baseName = pathinfo($fullPath, PATHINFO_FILENAME);
            $proposedTitle = $this->getCorrectTitle($baseName, $data['title'] ?? '');
            $slug = Str::slug($proposedTitle !== '' ? $proposedTitle : $baseName);
            // Avoid generic titles causing collisions; ensure uniqueness across tales
            $ensureUnique = function (string $trySlug) use ($baseName, $fullPath) {
                $slugCandidate = $trySlug !== '' ? $trySlug : Str::slug($baseName);
                $original = $slugCandidate;
                $i = 1;
                while (\App\Models\Tale::where('slug', $slugCandidate)->exists()) {
                    $i++;
                    $slugCandidate = $original . '-' . $i;
                    if ($i > 50) { // fallback hard stop
                        $slugCandidate = Str::slug($baseName) . '-' . substr(md5($baseName), 0, 6);
                        break;
                    }
                }
                return $slugCandidate;
            };
            $slug = $ensureUnique($slug);

            $coverUrl = null;
            if (!empty($data['cover']) && !empty($data['cover']['data'])) {
                $ext = $data['cover']['extension'] ?? 'jpg';
                Storage::disk('public')->put("tales/covers/{$slug}-cover.{$ext}", $data['cover']['data']);
                $coverUrl = "/storage/tales/covers/{$slug}-cover.{$ext}";
            }

            // Get description for this tale
            $description = $this->getTaleDescription($proposedTitle);
            $meta = $data['meta'] ?? [];
            if ($description) {
                $meta['description'] = $description;
            }
            
            $tale = Tale::updateOrCreate(
                ['source_filename' => basename($fullPath)],
                [
                    'title' => $proposedTitle !== '' ? $proposedTitle : $baseName,
                    'slug' => $slug,
                    'cover_url' => $coverUrl,
                    'toc' => $data['toc'] ?? [],
                    'meta' => $meta,
                ]
            );

            if (!empty($data['sections'])) {
                $tale->sections()->delete();
                foreach ($data['sections'] as $index => $section) {
                    $tale->sections()->create([
                        'order' => $index + 1,
                        'title' => $section['title'] ?? null,
                        'anchor' => $section['anchor'] ?? null,
                        'body_html' => $section['body_html'] ?? null,
                        'body_text' => $section['body_text'] ?? null,
                    ]);
                }
            }
        }

        $this->info('Импорт завершен.');
        return self::SUCCESS;
    }

    /**
     * Get the correct title for a file based on filename mapping
     */
    private function getCorrectTitle(string $filename, string $extractedTitle): string
    {
        $titleMapping = [
            '1 Faun' => 'ФАВН',
            '2 Tanz der Empussa' => 'ТАНЕЦ    ЭМПУСЫ',
            '3 Volontären für Kirka' => 'Волонтеры Кирки',
            '4 Argonauten' => 'ARGONAUTEN',
            '5-Vandimenen Eiland' => 'VANDIMENEN EILAND',
            '1-Fortinbras ist gekommen' => 'FORTINBRAS IST GEKOMMEN',
            '1-Weiße Stirn. Grenze' => 'БЕЛОЛОБЫЙ. РУБЕЖ',
            '1.Im Gesetzkörper (Säule und Mond) ' => 'ЛУНА И СТОЛБ. В ТЕЛЕ ЗАКОНА',
            '2-Blauenstadt' => 'BLAUENSTADT',
            '2-Velichan' => 'ВЕЛИХАН',
            '2.Melisanda ' => 'МЕЛИСАНДА. ПОПЫТКА ОДНОЙ РЕАБИЛИТАЦИИ',
            '2.Драконья гора ' => 'Драконья Гора',
            '3-Blick werfen der Mond,Herr Oberst!' => 'ВЗГЛЯНЕМ НА ЛУНУ, ПОЛКОВНИК!',
            '3.Berchtesgaden ' => 'BERCHESTCADEN',
            '3.Пороги Луны ' => 'Пороги Луны',
            '4.Krähen Freiheit ' => ' ВОРОНЬЯ   СЛОБОДА',
            '4.Плесень в Храме ' => 'Плесень в Храме',
            '5.Anadyr ' => 'Anadyr',
            '5.Пленэр ' => 'Пленэр',
            '6.Малые формы ' => 'Малые формы',
            '7.Либретто ' => 'Либретто',
            '8.Романтический хулиган ' => 'Романтический хулиган',
            '1.Ритмы поднебесной ' => 'Ритмы поднебесной',
        ];

        // Check if we have a mapping for this filename (without extension)
        if (isset($titleMapping[$filename])) {
            return $titleMapping[$filename];
        }

        // Fallback to extracted title or filename
        return trim($extractedTitle) !== '' ? trim($extractedTitle) : $filename;
    }
    
    /**
     * Get description for a tale based on title
     */
    private function getTaleDescription(string $title): ?string
    {
        $descriptions = [
            'ФАВН' => 'Экспериментальная повесть Виктора Хоффа, исследующая мифологические архетипы в современном городском пространстве. Произведение сочетает элементы психологического реализма с мифологическими мотивами, создавая уникальный сплав древних образов и современной экзистенциальной проблематики. История разворачивается в хмуром утреннем пейзаже, где мифологический персонаж фавна сталкивается с реалиями современного мира, включая аэропорты и городскую инфраструктуру. Повесть разделена на две части: "Проделки фавна" и "Аэропорт", каждая из которых раскрывает различные грани столкновения мифологического сознания с урбанистической реальностью, создавая многогранное исследование одиночества и поиска своего места в современном мире.',
            'ТАНЕЦ    ЭМПУСЫ' => 'Экспериментальная мифологическая проза, исследующая древнегреческие архетипы через призму современного сознания. Произведение обращается к образам эмпус — мифологических существ из греческой мифологии, известных своей двойственной природой и способностью принимать различные обличья. Текст сочетает архаические мифологические мотивы с современными литературными техниками, создавая многослойное повествование о столкновении древних сил с современной реальностью. Автор использует танец как метафору ритма жизни и смерти, исследуя темы трансформации, соблазна и разрушения. Композиция произведения включает прелюд и различные голоса, где мифологические персонажи получают современное звучание, раскрывая архетипические паттерны человеческого поведения и подсознательных страхов.',
            'Волонтеры Кирки' => 'Глубокая психологическая драма о женской судьбе и внутренней борьбе, основанная на мифологических образах Кирки (Цирцеи) — могущественной волшебницы из "Одиссеи". Произведение исследует сложные взаимоотношения между персонажами через призму мифологических образов и современного психологического анализа. Текст сочетает элементы реализма с символическими мотивами, создавая пронзительное повествование о любви, утрате и поиске смысла. История повествует о девушке, бегущей по песчаной косе, поглощаемой жадными взглядами волн, что становится мощной метафорой внутреннего конфликта и борьбы с собственными демонами. Произведение исследует темы власти, подчинения и освобождения, где волонтеры Кирки символизируют тех, кто добровольно следует за соблазнительными иллюзиями, теряя свою истинную природу.',
            'ARGONAUTEN' => 'Мощная мифологическая проза, переосмысливающая древнегреческие легенды о путешествии аргонавтов в современном контексте. Произведение исследует темы героизма, поиска золотого руна и внутреннего путешествия через образы лейтенанта и его духовных исканий. Текст сочетает архаические мифологические мотивы с современными психологическими и философскими измерениями, создавая многослойное повествование о поиске смысла и истины. Автор мастерски использует образы древних героев для исследования современных проблем человеческого существования, где путешествие становится метафорой духовного роста и самопознания. Произведение включает такие разделы, как "Беглец" и "Белый тополь", каждый из которых раскрывает различные аспекты мифологического путешествия, превращая древний эпос в современную философскую притчу о поиске своего предназначения и преодолении внутренних препятствий.',
            'FORTINBRAS IST GEKOMMEN' => 'Мощная драматическая интерпретация шекспировского "Гамлета" в современной немецкой прозе. Произведение исследует темы власти, мести и судьбы через призму персонажей принца, Гертруды и Лаэрта. Текст разворачивается в символических пространствах — зеркальной зале, лягушачьем гроте и черной башне, создавая многослойную структуру повествования. Автор переосмысливает классические шекспировские мотивы, добавляя современные психологические и философские измерения, исследуя природу власти, семейных связей и личной ответственности в контексте политических интриг. Каждый персонаж получает собственную сцену, где внутренний монолог раскрывает глубины человеческой души, а символические пространства становятся метафорами различных состояний сознания и уровней реальности.',
            'БЕЛОЛОБЫЙ. РУБЕЖ' => 'Экзистенциальная проза о границах и пограничье человеческого бытия, где образ белобого персонажа становится символом пограничного состояния между различными мирами и состояниями сознания. Произведение исследует темы идентичности, принадлежности и отчуждения через образы пограничных пространств и состояний. Текст создает атмосферу внутреннего напряжения и поиска своего места в мире, где каждый персонаж находится на рубеже — между прошлым и настоящим, между реальностью и иллюзией, между жизнью и смертью. Структура произведения включает такие разделы, как "Александр. Ночной дозор", "Визит. Улыбка Джоконды", где образ паромщика становится ключевой фигурой, связывающей различные пространства и временные пласты, создавая сложное повествование о преодолении границ и поиске истинной сущности.',
            'ЛУНА И СТОЛБ. В ТЕЛЕ ЗАКОНА' => 'Философская проза о власти символов и структур в человеческой жизни, где уличный столб и луна становятся центральными образами метафизического исследования порядка и хаоса. Произведение исследует темы порядка, закона и их влияния на индивидуальное существование через образы архитектурных и космических элементов. Текст сочетает метафизические размышления с конкретными образами, создавая многослойное повествование о том, как внешние структуры формируют внутренний мир человека. Открывающий образ "Трупов на мостовой" и столба, который "понуро смотрится в тротуар", создает атмосферу городского одиночества и механистичности современной жизни. Произведение раскрывает тему "тела закона" — того, как абстрактные правила и нормы материализуются в физическом пространстве, влияя на каждый аспект человеческого существования, где столб становится символом неизменности порядка, а луна — метафорой вечного изменения и мистического начала.',
            'BLAUENSTADT' => 'Урбанистическая повесть о городском пространстве и его обитателях, где синий цвет становится лейтмотивом исследования мегаполиса. Произведение исследует темы одиночества в толпе, отчуждения и поиска человеческих связей в современном мегаполисе. Текст создает атмосферу синего города, где персональные драмы разворачиваются на фоне безличных архитектурных масс. Повесть начинается с "Веронской улицы" в субботу после дождя, где дождевая вода и городской пейзаж становятся активными участниками действия. Структура произведения, включающая "Лоно" и различные городские локации, раскрывает многослойность городского пространства как физического, так и психологического ландшафта. Автор мастерски передает ощущение потерянности человека в урбанистическом лабиринте, где улицы становятся артериями современной жизни, а площади — местами встречи и расставания, создавая пронзительный портрет современного городского существования.',
            'ВЕЛИХАН' => 'Психологическая повесть о внутреннем конфликте и поиске себя, где образ Велихана становится центральной фигурой исследования человеческой природы. Произведение исследует сложные взаимоотношения между героем и его окружением, раскрывая глубины человеческой души через психологический анализ и символические образы. Текст создает атмосферу внутреннего напряжения, где каждый персонаж становится носителем определенных качеств и страхов. Начало произведения с описанием процесса фильтрации пива становится метафорой очищения и отделения существенного от случайного, что символизирует внутренний процесс самопознания главного героя. Повесть включает авторское предисловие и предисловие издательства, создавая многослойную структуру повествования, где различные точки зрения раскрывают различные грани истории, исследуя темы идентичности, памяти и поиска истинного "я" в сложном переплетении личных и общественных связей.',
            'МЕЛИСАНДА. ПОПЫТКА ОДНОЙ РЕАБИЛИТАЦИИ' => 'Глубокая психологическая драма, представляющая попытку реабилитации образа Мелисанды из пьесы Мориса Метерлинка "Пеллеас и Мелисанда". Произведение исследует сложную психологию женского персонажа, стоящего у обрыва и облокотившегося на металлические перила. Текст сочетает элементы символизма с современным психологическим анализом, исследуя темы любви, ревности, предательства и внутреннего конфликта. Автор создает многослойное повествование о женской судьбе, где тонкие и бледные руки героини становятся символом хрупкости и силы одновременно. Произведение посвящено Н., что добавляет личностное измерение в интерпретацию классического образа. Мелисанда предстает не как пассивная жертва обстоятельств, а как активная фигура, пытающаяся понять и изменить свою судьбу, где образ обрыва становится метафорой пограничного состояния между жизнью и смертью, между реальностью и иллюзией, создавая пронзительный портрет женской психологии и внутренней борьбы.',
            'Драконья Гора' => 'Изящная китайская пейзажная поэзия, воспевающая красоту природы и глубину философских размышлений. Стихи создают атмосферу глухого молчания рассвета, где мостик на рисовом поле становится символом связи между мирами. Поэзия исследует темы свежести утреннего солнца, осеннего нисхождения с гор и абрикосового сада у реки Ванчуань. Произведение демонстрирует традиционную китайскую эстетику, где природа отражает внутреннее состояние души, а капли росы и солнечные лучи становятся метафорами духовного просветления. Каждый образ — от рисового поля до горного пейзажа — несет в себе глубокий философский смысл, создавая картину гармоничного единения человека с природой, где времена года и природные циклы отражают внутренние процессы человеческой души, демонстрируя мастерство китайской поэтической традиции с её характерными образами, символами и ритмическими структурами.',
            'ВЗГЛЯНЕМ НА ЛУНУ, ПОЛКОВНИК!' => 'Драматическая повесть с элементами мистики и военной тематики, где лунная символика становится центральным образом исследования власти и подчинения. Произведение исследует темы власти, подчинения и внутреннего сопротивления через образы военной иерархии и лунной символики. Текст создает атмосферу напряжения и поиска истины, где военная структура становится метафорой более широких общественных отношений. Повесть включает разделы "Движение в пустоте. Ульрих" и "Пролог. Аттракцион в аквариуме", "Привал в пути. Адриан", создавая многослойное повествование о различных уровнях реальности и сознания. Образ луны, на которую предлагается взглянуть, становится символом истины, скрытой за видимостью военной дисциплины и иерархии. Автор исследует природу власти, где полковник олицетворяет авторитарную структуру, а призыв взглянуть на луну становится актом внутреннего освобождения и поиска трансцендентного начала, выходящего за рамки формальных отношений подчинения.',
            'BERCHESTCADEN' => 'Историческая проза, размышляющая о прошлом и его влиянии на настоящее через призму немецкой истории. Произведение исследует темы памяти, ответственности и наследия прошлого, используя образы почтамта 76 как символа бюрократической системы и китайской шкатулки как метафоры скрытого прошлого. Текст создает атмосферу рефлексии о исторических событиях и их последствиях для современного общества. Структура произведения включает разделы "Кафе вечером. Overture", "Жужжание полусонных мух. Ромашка в з...", где каждый образ несет в себе историческую память и философское значение. Берчтесгаден, известный исторический город, становится местом встречи различных временных пластов, где прошлое продолжает влиять на настоящее, а личные истории переплетаются с коллективной историей нации. Автор мастерски передает сложность исторической памяти, где каждый символ — от почтамта до кафе — становится носителем исторического бремени и ответственности перед будущим.',
            'Пороги Луны' => 'Лирическая поэзия, исследующая темы одиночества и поиска смысла через образы ночного пейзажа и лунного света. Стихи создают атмосферу таинственности и меланхолии, где черная луна изумрудного пруда становится символом глубинных переживаний. Поэзия исследует темы любви, потери и духовного поиска, используя образы ночи, воды и лунного света как метафоры внутреннего мира. Произведение сочетает современную лирическую технику с традиционными поэтическими образами, создавая многослойное повествование о человеческих чувствах и переживаниях. Название "О, Луна!" и подзаголовок "Гимн" указывают на сакральный характер обращения к лунному свету как источнику откровения и утешения. Поэзия исследует пороги — как физические границы между мирами, так и метафизические границы между сознанием и подсознанием, между реальностью и мечтой, создавая пронзительное исследование человеческой души в её поисках гармонии и смысла.',
            ' ВОРОНЬЯ   СЛОБОДА' => 'Философская повесть о свободе и ее границах, где образ вороньего мира становится метафорой исследования интеллигенции и культурных элит. Произведение исследует темы воли, выбора и ответственности через образы вороньего мира и символики свободы. Текст сочетает конкретные образы с абстрактными размышлениями о природе человеческой свободы. Структура произведения включает разделы в стиле кёгэна для театра Но, что подчеркивает синтез восточных и западных культурных традиций. Название "И восходит солнце" указывает на тему просветления и нового начала. Повесть представляет собой "Книгу об интеллигенции Мэйла", где каждый раздел раскрывает различные аспекты свободы — от её внешних проявлений до внутренних ограничений. Вороны, символы мудрости и предсказания в различных мифологиях, становятся метафорой тех, кто стремится к свободе, но одновременно связан невидимыми узами общества и культуры. Автор исследует сложную природу свободы как философской категории и практической реальности.',
            'Плесень в Храме' => 'Глубокая философская проза о духовном упадке и поиске истины в современном мире. Произведение исследует темы духовного кризиса, где храм становится символом утраченных идеалов, а плесень — метафорой разложения духовных ценностей. Текст создает атмосферу гладиаторской борьбы на арене жизни, где каждый человек ищет свою свободу и смысл существования. Открывающий образ гладиаторов, разделенных веками, но объединенных общим проклятием и поиском свободы, становится мощной метафорой человеческого состояния. Автор мастерски передает ощущение духовного вакуума современного общества, где традиционные ценности разрушаются, а новые еще не сформированы. Произведение исследует темы поиска истины, духовного возрождения и борьбы за человеческое достоинство в мире, где материальные ценности преобладают над духовными, а храм — место священное — становится символом утраченной сакральности и места, где плесень разложения олицетворяет духовную коррупцию современного мира.',
            'Anadyr' => 'Полярная повесть о жизни в экстремальных условиях северной тундры, где образ Анадыря — чукотского города на Дальнем Востоке России — становится центральным символом исследования человеческой стойкости. Произведение исследует темы выживания, человеческой стойкости и взаимоотношений человека с суровой природой. Текст создает атмосферу холода, льда и сияния северного сияния, где каждый образ несет в себе ощущение экстремального существования. Структура произведения включает разделы "Послание голландца", "Древняя притча", "Смерть под...", где переплетаются различные культурные традиции и временные пласты. Почтовая сумка (Briefträgertasche) становится символом связи между мирами, между цивилизацией и дикой природой. Автор исследует темы изоляции и одиночества в полярных условиях, где человек сталкивается не только с внешними вызовами природы, но и с внутренними демонами одиночества и экзистенциального отчаяния, создавая пронзительный портрет человеческого духа перед лицом абсолютной стихии.',
            'Пленэр' => 'Художественная повесть о живописи и восприятии мира, где образы пленэрной живописи становятся центральными для исследования способности видеть и чувствовать красоту. Произведение исследует темы искусства, красоты и способности видеть через образы пленэрной живописи. Текст создает атмосферу света, цвета и художественного восприятия реальности, где каждый момент становится возможностью для художественного открытия. Стихотворение начинается с "Бликов на воде" и "Весеннего переполоха", где капля росы и солнечный луч становятся активными участниками действия, создающими динамику света и движения. Пленэр, техника живописи на открытом воздухе, становится метафорой непосредственного восприятия мира, где художник стремится запечатлеть мгновение в его чистой красоте, до того как оно исчезнет. Произведение исследует темы времени, изменчивости и вечности, где вальсирующая волна и искрящиеся брызги становятся символами мимолетности красоты и попытки художника остановить время через искусство.',
            'Малые формы' => 'Изящная минималистичная поэзия, исследующая мгновения и вечность через краткие, но глубокие образы. Стихи демонстрируют мастерство сжатой формы, где каждое слово несет максимальную смысловую нагрузку. Произведение исследует темы времени, памяти и человеческих переживаний через призму минималистичной эстетики. Начинается со стихотворения "Мечта дворняги", где образы купленной за бесценок собаки и дровосека в конуре под дождем создают атмосферу простоты и глубины одновременно. Поэзия сочетает традиционные формы краткой поэзии с современными экспериментальными техниками, создавая уникальный сплав восточной философии и западной поэтической традиции. Каждое стихотворение становится микрокосмом, отражающим универсальные человеческие переживания — от мечты о простом счастье до размышлений о смысле существования, где минималистичная форма служит средством достижения максимальной выразительности и эмоционального воздействия.',
            'Либретто' => 'Драматическое произведение в оперном формате, где каждый элемент текста предназначен для музыкального воплощения. Либретто исследует темы страсти, любви, ревности и судьбы через оперные образы и музыкальную драматургию. Текст создает атмосферу оперного театра с его эмоциональной напряженностью, где персонажи становятся носителями архетипических страстей. Произведение начинается с образа вина в златом бокале и обещания песни о печали, которая принесет радость, что становится ключевой метафорой оперного искусства как трансформации страдания в красоту. Образ "Гонца" в названии указывает на роль посланника между мирами — между реальностью и искусством, между страстью и её выражением. Либретто исследует оперные конвенции — от любовных треугольников до роковых страстей, где каждый персонаж становится символом определенного типа страсти или судьбы, создавая многослойное повествование о человеческих страстях, преображенных через искусство в вечные образы.',
            'Романтический хулиган' => 'Романтическая повесть с элементами бунтарства, где образ романтического героя-бунтаря получает современное звучание. Произведение исследует темы любви, свободы и неподчинения общественным нормам через образы романтического героя-хулигана. Текст сочетает романтические мотивы с современным звучанием, создавая многослойное повествование о поиске подлинности в мире условностей. Стихотворение начинается с контраста между "рокотом космодрома" и "глупеньким Ромео под балконом", где высокие технологии сталкиваются с вечными романтическими образами. Образы "моря крови" и "химеры маета" создают атмосферу романтического бунта против рационализма и механистичности современного мира. Произведение исследует темы противоречия между романтическим идеалом и реальностью, где хулиган становится символом того, кто отказывается подчиняться правилам, но при этом ищет подлинную любовь и свободу, создавая пронзительный портрет современного романтика-бунтаря, пытающегося сохранить человеческое в мире технологий.',
            'Ритмы поднебесной' => 'Сборник классической китайской поэзии, представляющий глубокие философские размышления о природе, времени и человеческом существовании. Поэзия отражает традиционные китайские эстетические принципы, где природа становится зеркалом человеческой души. Стихи исследуют темы гармонии с природой, цикличности времен года, и поиска внутреннего покоя через созерцание красоты окружающего мира. Произведение демонстрирует мастерство китайской поэтической традиции с её характерными образами, символами и ритмическими структурами. Каждое стихотворение становится медитацией о связи человека с космосом, где ритмы поднебесной — это не только природные циклы, но и внутренние ритмы человеческой души, синхронизированные с вселенской гармонией. Поэзия исследует конфуцианские и даосские концепции через конкретные природные образы, где каждый элемент природы — от цветка до горы — несет в себе глубокий философский смысл, создавая целостную картину мира как единого организма, частью которого является человек.',
            'VANDIMENEN EILAND' => 'Приключенческая повесть о путешествии к таинственному острову, где образ острова становится метафорой неизведанных территорий человеческой души. Произведение исследует темы открытия нового, встречи с неизвестным и личностного роста через образы морского путешествия и островных приключений. Текст создает атмосферу романтики и опасности, где каждый поворот сюжета открывает новые тайны. Структура произведения включает разделы "Волшебный рог бармена" и "Глава 2. Жрицы сов", "Ароматы и звуки ночи", создавая многослойное повествование о мистическом острове, где реальность переплетается с фантазией. Остров Вандименов, отсылающий к реальному острову Тасмания (Вандименова земля), становится местом встречи различных культур и времен, где европейская колониальная история сталкивается с древними мифологиями. Автор исследует темы колонизации, встречи цивилизаций и личностной трансформации через образы путешествия и открытия, где каждый персонаж — от бармена до жриц — становится носителем определенных тайн и знаний, создавая захватывающее повествование о поиске себя в экзотических и опасных территориях.',
        ];

        return $descriptions[$title] ?? null;
    }
}
